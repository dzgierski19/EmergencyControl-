<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Tomasz M. Karpiński">
    <title>Wybór służb</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        label, select, button {
            display: block;
            margin: 10px 0;
        }
        #karetka-opcje {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Wybierz odpowiednie służby i rodzaj zdarzenia</h1>
    <!--Formularz dla miejsca zdarzenia-->
    <label for="place">Miejsce zdarzenia:</label>
    <input type="text" id="place" readonly placeholder="Pobieranie lokalizacji...">
    <!--Formularz dla czasu zdarzenia-->
    <label for="time"> Czas zdarzenia:</label>
    <input type="datetime-local" id="time">

    
    <label for="service">Wybierz służby:</label>
    <select id="service" onchange="updateOptions()">
        <option value="">-- Wybierz służbę --</option>
        <option value="police">Policja</option>
        <option value="karetka">Karetka Pogotowia</option>
        <option value="straz">Straż Pożarna</option>
    </select>

    <label for="event">Wybierz rodzaj zdarzenia:</label>
    <select id="event" onchange="toggleKaretkaOpcje()">
        <option value="">-- Wybierz rodzaj zdarzenia --</option>
    </select>

    <div id="karetka-opcje">
        <label for="karetka-wypadek">Wybierz dodatkową opcję:</label>
        <select id="karetka-wypadek">
            <option value="karetka_i_straz">Potrzebna karetka i straż pożarna</option>
            <option value="karetka">Potrzebna karetka</option>
            <option value="brak_karetki">Karetka niepotrzebna</option>
        </select>
    </div>

    <button onclick="sendReport()">Wyślij zgłoszenie</button>

    <div id="result" style="margin-top: 20px; font-weight: bold;">

        
    </div>

    <script>
        const serviceOption = {
            police: ["Wypadek drogowy", "Kradzież", "Napad", "Atak terrorystyczny"],
            karetka: ["Osoba nieprzytomna", "Podejrzenie udaru", "Podejrzenie zawału", "Nagłe zachorowanie", "Zaostrzenie choroby przewlekłej", "Uraz lub złamanie"],
            straz: ["Pożar", "Wypadek drogowy", "Wyciek chemiczny", "Zalanie", "Usunięcie gniazda owadów"]
        };

        const zgloszenia = {
            wypadek_drogowy: { karetka_i_straz: ["Policja", "Straż Pożarna", "Pogotowie Ratunkowe"], karetka: ["Policja", "Pogotowie Ratunkowe"], brak_karetki: ["Policja"] },
            kradzież: ["Policja"],
            napad: ["Policja"],
            atak_terrorystyczny: ["Policja", "Straż Pożarna", "Pogotowie Ratunkowe"],
            osoba_nieprzytomna: ["Policja", "Pogotowie Ratunkowe"],
            podejrzenie_udaru: ["Pogotowie Ratunkowe"],
            podejrzenie_zawału: ["Pogotowie Ratunkowe"],
            nagłe_zachorowanie: ["Pogotowie Ratunkowe"],
            zaostrzenie_choroby_przewlekłej: ["Pogotowie Ratunkowe"],
            uraz_lub_złamanie: ["Pogotowie Ratunkowe"],
            pożar: ["Straż Pożarna"],
            zalanie: ["Straż Pożarna"],
            wyciek_chemiczny: ["Straż Pożarna", "Pogotowie Ratunkowe", "Policja"],
            usunięcie_gniazda_owadów: ["Straż Pożarna"]
        };

        function updateOptions() {
            const service = document.getElementById("service").value;
            const event = document.getElementById("event");
            event.innerHTML = '<option value="">-- Wybierz rodzaj zdarzenia --</option>';

            if (service && serviceOption[service]) {
                serviceOption[service].forEach(option => {
                    event.innerHTML += `<option value="${option.toLowerCase().replace(/ /g, "_")}">${option}</option>`;
                });
            }
        }

        function toggleKaretkaOpcje() {
            document.getElementById("karetka-opcje").style.display = document.getElementById("event").value === "wypadek_drogowy" ? "block" : "none";
        }

        function sendReport() {
            const event = document.getElementById("event").value;
            const karetkaOpcja = document.getElementById("karetka-wypadek").value;
            const place = document.getElementById("place").value;
            const time= document.getElementById("time").value;
            let result = "";

            if (event === "wypadek_drogowy") {
                result = `Zgłoszenie wysłane do: ${zgloszenia[event][karetkaOpcja].join(", ")}`;
            } else if (zgloszenia[event]) {
                result = `Zgłoszenie wysłane do: ${zgloszenia[event].join(", ")}`;
            } else {
                result = "Nie wybrano poprawnego rodzaju zdarzenia.";
            }

            document.getElementById("result").innerText = result;
        }

        /*
        Ta część musi automatycznie pobierać geolokacja i czas przy lądowaniu strony. Podaje info o geo jako szerokość i długość (można podlączyć API)
        */

        function getlocation(){ //pobiera geo
            const placeInput = document.getElementById("place");

            if(navigator.geolocation){
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                placeInput.placeholder = "Geolokalizacja nie jest wspierana przez tę przeglądarke"
            }
        }

        function showPosition(showPosition){
            const placeInput = document.getElementById("place");
            const latitude = position.coords.latitude.toFixed(6);
            const longitude = position.coords.longitude.toFixed(6);
            placeInput.value = "Szerokość: ${latitude}, dlugość: ${longitude}";
        }

        function setCurrentTime(){
            const timeInput =document.getElementById("time")
            const now = new Date();
            const localISOTime =now.toISOString().slice(0,16);
            timeInput.value = localISOTime;
        }
        
        function showError(error){
            const placeInput =document.getElementById("place");
            switch(error.code){
                case error.PERMISSION_DENIED:
                    placeInput.placeholder = "Użytkownik odmówił w udostępnieniu geolokalizacji."
                    break;
                case error.POSITION_UNAVAILABLE:
                    placeInput = "Informacja o geolokolizacji nie jest dostępna."
                    break;
                case error.TIMEOUT:
                    placeInput.placeholder = "Przekroczono czas oczekiwania na lokalizacje."
                break;    
            }

        }



        window.onload = function(){
            getlocation();
            setCurrentTime();
        }
    </script>
</body>
</html>
